<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, shrink-to-fit=no"
    />
    <title>Sphere - Expense Summary</title>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap"
      rel="stylesheet"
    />
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css"
      rel="stylesheet"
    />
    <link href="assets/css/app.css" rel="stylesheet" />
    <script
      defer
      src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"
    ></script>
    <style>
      body {
        font-family: "Poppins", sans-serif;
      }

      .stat-card {
        height: 150px;
      }

      .icon-circle {
        width: 56.25px;
        height: 56.25px;
        box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
      }

      .icon-circle i {
        font-size: 27px;
      }
    </style>
  </head>
  <body>
    <div class="wrapper">
      <nav id="sidebar" class="sidebar js-sidebar">
        <div class="sidebar-content js-simplebar">
          <a class="sidebar-brand mb-3" href="userDashboard.html">
            <i class="bi bi-globe align-middle"></i>
            <span class="align-middle ms-1">Sphere</span>
          </a>

          <ul class="sidebar-nav">
            <li class="sidebar-item">
              <a class="sidebar-link" href="userDashboard.html">
                <i class="bi bi-speedometer2 align-middle"></i>
                <span class="align-middle">Dashboard</span>
              </a>
            </li>

            <li class="sidebar-item active">
              <a
                data-bs-target="#expenses"
                data-bs-toggle="collapse"
                class="sidebar-link collapsed"
                aria-expanded="false"
              >
                <i class="bi bi-wallet2 align-middle"></i>
                <span class="align-middle">Expenses</span>
              </a>
              <ul
                id="expenses"
                class="sidebar-dropdown list-unstyled collapse"
                data-bs-parent="#sidebar"
              >
                <li class="sidebar-item">
                  <a class="sidebar-link" href="expenses.html"
                    >Manage Expenses</a
                  >
                </li>
                <li class="sidebar-item">
                  <a class="sidebar-link" href="expenseCategories.html"
                    >Expense Categories</a
                  >
                </li>
                <li class="sidebar-item">
                  <a class="sidebar-link" href="expenseLabels.html"
                    >Expense Labels</a
                  >
                </li>
                <li class="sidebar-item active">
                  <a class="sidebar-link" href="expenseSummary.html"
                    >Expense Summary</a
                  >
                </li>
              </ul>
            </li>

            <li class="sidebar-item">
              <a
                data-bs-target="#invoices"
                data-bs-toggle="collapse"
                class="sidebar-link collapsed"
                aria-expanded="false"
              >
                <i class="bi bi-file-earmark-text align-middle"></i>
                <span class="align-middle">Invoices</span>
              </a>
              <ul
                id="invoices"
                class="sidebar-dropdown list-unstyled collapse"
                data-bs-parent="#sidebar"
              >
                <li class="sidebar-item">
                  <a class="sidebar-link" href="invoices.html"
                    >Manage Invoices</a
                  >
                </li>
                <li class="sidebar-item">
                  <a class="sidebar-link" href="invoiceAccounts.html"
                    >Invoice Accounts</a
                  >
                </li>
                <li class="sidebar-item">
                  <a class="sidebar-link" href="invoiceSummary.html"
                    >Invoice Summary</a
                  >
                </li>
              </ul>
            </li>

            <li class="sidebar-item">
              <a class="sidebar-link" href="tasks.html">
                <i class="bi bi-list-task align-middle"></i>
                <span class="align-middle">Tasks</span>
              </a>
            </li>

            <li class="sidebar-item">
              <a class="sidebar-link" href="clients.html">
                <i class="bi bi-people align-middle"></i>
                <span class="align-middle">Clients</span>
              </a>
            </li>

            <li class="sidebar-item">
              <a class="sidebar-link" href="staff.html">
                <i class="bi bi-person-badge align-middle"></i>
                <span class="align-middle">Staff</span>
              </a>
            </li>

            <li class="sidebar-item">
              <a class="sidebar-link" href="userProfile.html">
                <i class="align-middle" data-feather="user"></i>
                <span class="align-middle">Profile</span>
              </a>
            </li>
          </ul>
        </div>
      </nav>

      <div class="main">
        <nav class="navbar navbar-expand navbar-light navbar-bg">
          <a class="sidebar-toggle js-sidebar-toggle">
            <i class="hamburger align-self-center"></i>
          </a>

          <div class="navbar-collapse collapse">
            <ul class="navbar-nav navbar-align">
              <li class="nav-item dropdown">
                <a
                  class="nav-icon dropdown-toggle"
                  href="#"
                  id="alertsDropdown"
                  data-bs-toggle="dropdown"
                >
                  <div class="position-relative">
                    <i class="align-middle" data-feather="bell"></i>
                    <span class="indicator">4</span>
                  </div>
                </a>
                <div
                  class="dropdown-menu dropdown-menu-lg dropdown-menu-end py-0"
                  aria-labelledby="alertsDropdown"
                >
                  <div class="dropdown-menu-header">4 New Notifications</div>
                  <div class="list-group">
                    <a href="#" class="list-group-item">
                      <div class="row g-0 align-items-center">
                        <div class="col-2">
                          <i
                            class="text-danger"
                            data-feather="alert-circle"
                          ></i>
                        </div>
                        <div class="col-10">
                          <div class="text-dark">Update completed</div>
                          <div class="text-muted small mt-1">
                            Restart server 12 to complete the update.
                          </div>
                          <div class="text-muted small mt-1">30m ago</div>
                        </div>
                      </div>
                    </a>
                    <a href="#" class="list-group-item">
                      <div class="row g-0 align-items-center">
                        <div class="col-2">
                          <i class="text-warning" data-feather="bell"></i>
                        </div>
                        <div class="col-10">
                          <div class="text-dark">Lorem ipsum</div>
                          <div class="text-muted small mt-1">
                            Aliquam ex eros, imperdiet vulputate hendrerit et.
                          </div>
                          <div class="text-muted small mt-1">2h ago</div>
                        </div>
                      </div>
                    </a>
                    <a href="#" class="list-group-item">
                      <div class="row g-0 align-items-center">
                        <div class="col-2">
                          <i class="text-primary" data-feather="home"></i>
                        </div>
                        <div class="col-10">
                          <div class="text-dark">Login from 192.186.1.8</div>
                          <div class="text-muted small mt-1">5h ago</div>
                        </div>
                      </div>
                    </a>
                    <a href="#" class="list-group-item">
                      <div class="row g-0 align-items-center">
                        <div class="col-2">
                          <i class="text-success" data-feather="user-plus"></i>
                        </div>
                        <div class="col-10">
                          <div class="text-dark">New connection</div>
                          <div class="text-muted small mt-1">
                            Christina accepted your request.
                          </div>
                          <div class="text-muted small mt-1">14h ago</div>
                        </div>
                      </div>
                    </a>
                  </div>
                  <div class="dropdown-menu-footer">
                    <a href="notifications.html" class="text-muted"
                      >Show all notifications</a
                    >
                  </div>
                </div>
              </li>
              <li class="nav-item dropdown">
                <a
                  class="nav-icon dropdown-toggle d-inline-block d-sm-none"
                  href="#"
                  data-bs-toggle="dropdown"
                >
                  <i class="align-middle" data-feather="settings"></i>
                </a>

                <a
                  class="nav-link dropdown-toggle d-none d-sm-inline-block"
                  href="#"
                  data-bs-toggle="dropdown"
                >
                  <i class="align-middle" data-feather="user"></i>
                  <span class="text-dark align-middle">John Doe</span>
                </a>
                <div class="dropdown-menu dropdown-menu-end">
                  <a class="dropdown-item" href="userProfile.html"
                    ><i class="align-middle me-1" data-feather="user"></i>
                    Profile</a
                  >
                  <a class="dropdown-item" href="signIn.html"
                    ><i class="align-middle me-1" data-feather="log-out"></i>
                    Log out</a
                  >
                </div>
              </li>
            </ul>
          </div>
        </nav>

        <main class="content" x-data="expenseSummary()">
          <div class="container-fluid p-0">
            <h1 class="mb-4 text-secondary">Expense Summary</h1>

            <form class="d-flex gap-2 mb-3">
              <select
                class="form-select w-auto bg-light"
                x-model="selectedYear"
                @change="updateChart"
              >
                <template x-for="year in sortedYears">
                  <option :value="year" x-text="year"></option>
                </template>
              </select>

              <select
                class="form-select w-auto bg-light"
                x-model="selectedMonth"
                @change="updateChart"
              >
                <template x-for="month in months">
                  <option :value="month" x-text="month"></option>
                </template>
              </select>
            </form>

            <div class="row">
              <div class="col-xl-6 col-xxl-5 d-flex">
                <div class="w-100">
                  <div class="row">
                    <div class="col-sm-6">
                      <div
                        class="card stat-card py-3 d-flex flex-row justify-content-between align-items-center bg-danger"
                      >
                        <div class="card-body p-0 ms-3">
                          <h5 class="card-title text-white">Total Expenses</h5>
                          <p
                            class="card-text fs-4 text-white"
                            x-text="'$' + totalExpenses"
                          ></p>
                        </div>
                        <div
                          class="icon-circle me-3 d-flex justify-content-center align-items-center rounded-circle bg-white"
                        >
                          <i class="bi bi-cash-coin text-danger"></i>
                        </div>
                      </div>

                      <div
                        class="card stat-card py-3 d-flex flex-row gap-2 justify-content-between align-items-center bg-success"
                      >
                        <div class="card-body p-0 ms-3">
                          <h5 class="card-title text-white">
                            Remaining Budget
                          </h5>
                          <p
                            class="card-text fs-4 text-white"
                            x-text="'$' + remainingBudget"
                          ></p>
                        </div>
                        <div
                          class="icon-circle me-3 d-flex justify-content-center align-items-center rounded-circle bg-white"
                        >
                          <i class="bi bi-wallet2 text-success"></i>
                        </div>
                      </div>
                    </div>

                    <div class="col-sm-6">
                      <div
                        class="card stat-card py-3 d-flex flex-row justify-content-between align-items-center bg-primary"
                      >
                        <div class="card-body p-0 ms-3">
                          <h5 class="card-title text-white">Top Category</h5>
                          <p
                            class="card-text fs-4 text-white"
                            x-text="topCategory.label"
                          ></p>
                        </div>
                        <div
                          class="icon-circle me-3 d-flex justify-content-center align-items-center rounded-circle bg-white"
                        >
                          <i class="bi bi-award text-primary"></i>
                        </div>
                      </div>

                      <div
                        class="card stat-card py-3 d-flex flex-row justify-content-between align-items-center bg-warning"
                      >
                        <div class="card-body p-0 ms-3">
                          <h5 class="card-title text-white">
                            Average Daily Spend
                          </h5>
                          <p
                            class="card-text fs-4 text-white"
                            x-text="'$' + averageDailySpend"
                          ></p>
                        </div>
                        <div
                          class="icon-circle me-3 d-flex justify-content-center align-items-center rounded-circle bg-white"
                        >
                          <i class="bi bi-graph-up text-warning"></i>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>

              <div class="col-xl-6 col-xxl-7">
                <div class="card flex-fill w-100">
                  <div class="card-header">
                    <h5 class="card-title">Expense Distribution</h5>
                  </div>
                  <div class="card-body d-flex">
                    <div class="align-self-center w-100">
                      <div class="py-3">
                        <div class="chart chart-xs">
                          <canvas id="chartjs-pie"></canvas>
                        </div>
                      </div>

                      <table class="table mb-0">
                        <tbody>
                          <template
                            x-for="category in categories"
                            :key="category.key"
                          >
                            <tr>
                              <td class="d-flex align-items-center gap-3">
                                <div
                                  class="rounded-circle"
                                  :style="{ backgroundColor: category.color, width: '10px', height: '10px' }"
                                ></div>
                                <span x-text="category.label"></span>
                              </td>
                              <td
                                class="text-end"
                                x-text="'$' + totals[category.key]"
                              ></td>
                            </tr>
                          </template>
                        </tbody>
                      </table>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </main>
      </div>
    </div>

    <script src="assets/js/app.js"></script>

    <script>
      document.addEventListener("alpine:init", () => {
        Alpine.data("expenseSummary", () => {
          const data = {
            2020: {
              travel: [50, 42, 37, 68, 55, 49, 62, 75, 51, 84, 58, 73],
              utilities: [38, 30, 49, 40, 52, 45, 67, 70, 62, 77, 83, 79],
              foodAndDining: [45, 40, 35, 50, 55, 60, 48, 72, 66, 81, 64, 87],
              entertainment: [42, 50, 38, 43, 59, 57, 60, 63, 70, 76, 79, 80],
              officeSupplies: [33, 37, 41, 55, 48, 56, 62, 69, 74, 78, 83, 81],
            },
            2021: {
              travel: [60, 58, 43, 39, 70, 51, 67, 80, 75, 82, 64, 89],
              utilities: [32, 44, 48, 50, 41, 60, 63, 68, 75, 78, 81, 83],
              foodAndDining: [35, 38, 42, 55, 58, 62, 65, 70, 74, 77, 80, 85],
              entertainment: [30, 36, 49, 52, 45, 61, 64, 67, 72, 79, 81, 88],
              officeSupplies: [39, 42, 47, 55, 52, 60, 68, 70, 74, 76, 84, 86],
            },
            2022: {
              travel: [48, 40, 50, 64, 53, 55, 67, 75, 72, 81, 62, 88],
              utilities: [45, 38, 42, 48, 54, 59, 65, 69, 74, 79, 82, 85],
              foodAndDining: [34, 43, 47, 53, 57, 63, 67, 71, 76, 78, 81, 86],
              entertainment: [37, 40, 44, 52, 56, 62, 65, 68, 73, 77, 80, 84],
              officeSupplies: [41, 46, 49, 53, 58, 63, 66, 71, 74, 78, 83, 87],
            },
            2023: {
              travel: [52, 44, 40, 56, 63, 51, 65, 72, 77, 79, 83, 86],
              utilities: [36, 39, 45, 49, 53, 60, 62, 68, 73, 76, 79, 82],
              foodAndDining: [40, 42, 48, 52, 58, 62, 66, 71, 74, 78, 80, 84],
              entertainment: [38, 46, 50, 55, 57, 60, 67, 69, 72, 76, 81, 85],
              officeSupplies: [35, 43, 48, 52, 56, 61, 65, 68, 73, 77, 82, 86],
            },
            2024: {
              travel: [44, 49, 55, 58, 62, 66, 70, 74, 78, 82, 85, 88],
              utilities: [40, 44, 47, 52, 57, 62, 66, 69, 74, 79, 82, 87],
              foodAndDining: [38, 43, 46, 53, 59, 64, 67, 72, 76, 80, 84, 89],
              entertainment: [42, 47, 50, 55, 58, 62, 67, 70, 74, 78, 81, 85],
              officeSupplies: [39, 41, 48, 52, 56, 61, 64, 68, 73, 77, 81, 86],
            },
          };

          const categories = [
            { key: "travel", label: "Travel", color: window.theme.success },
            {
              key: "utilities",
              label: "Utilities",
              color: window.theme.primary,
            },
            {
              key: "foodAndDining",
              label: "Food & Dining",
              color: window.theme.warning,
            },
            {
              key: "entertainment",
              label: "Entertainment",
              color: window.theme.info,
            },
            {
              key: "officeSupplies",
              label: "Office Supplies",
              color: window.theme.danger,
            },
          ];

          const months = [
            "January",
            "February",
            "March",
            "April",
            "May",
            "June",
            "July",
            "August",
            "September",
            "October",
            "November",
            "December",
          ];

          const sortedYears = Object.keys(data)
            .map(Number)
            .sort((a, b) => b - a);
          const recentYear = sortedYears[0];
          let chart;

          function initializeChart(selectedYear, monthIndex) {
            const ctx = document.getElementById("chartjs-pie").getContext("2d");
            chart = new Chart(ctx, {
              type: "pie",
              data: {
                labels: categories.map((c) => c.label),
                datasets: [
                  {
                    data: categories.map(
                      (c) => data[selectedYear][c.key][monthIndex]
                    ),
                    backgroundColor: categories.map((c) => c.color),
                    borderColor: "transparent",
                  },
                ],
              },
              options: {
                maintainAspectRatio: false,
                legend: {
                  display: false,
                },
              },
            });
          }

          return {
            data,
            categories,
            sortedYears,
            months,
            selectedYear: recentYear,
            selectedMonth: months[0],
            monthlyBudget: 500,
            get currentMonthIndex() {
              return this.months.indexOf(this.selectedMonth);
            },
            get totals() {
              return Object.fromEntries(
                this.categories.map((c) => [
                  c.key,
                  data[this.selectedYear][c.key][this.currentMonthIndex],
                ])
              );
            },
            get totalExpenses() {
              return Object.values(this.totals).reduce(
                (sum, value) => sum + value,
                0
              );
            },
            get remainingBudget() {
              return this.monthlyBudget - this.totalExpenses;
            },
            get topCategory() {
              const maxKey = Object.entries(this.totals).reduce(
                (max, [key, value]) =>
                  value > (max.value || 0) ? { key, value } : max,
                {}
              );
              return (
                this.categories.find((c) => c.key === maxKey.key) || {
                  label: "None",
                  value: 0,
                }
              );
            },
            get averageDailySpend() {
              const daysInMonth = new Date(
                this.selectedYear,
                this.currentMonthIndex + 1,
                0
              ).getDate();
              return (this.totalExpenses / daysInMonth).toFixed(2);
            },
            init() {
              this.updateChart();
            },
            updateChart() {
              if (!chart) {
                initializeChart(this.selectedYear, this.currentMonthIndex);
              } else {
                chart.data.datasets[0].data = categories.map(
                  (c) => data[this.selectedYear][c.key][this.currentMonthIndex]
                );
                chart.update();
              }
            },
          };
        });
      });
    </script>
  </body>
</html>
